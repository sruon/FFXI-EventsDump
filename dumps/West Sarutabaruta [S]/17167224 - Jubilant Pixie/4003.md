# Event 4003

## Metadata

| Field           | Value     |
|-----------------|-----------|
| Event Index     | 2/6       |
| Offset          | 0x0001    |
| Data Size       | 590 bytes |
| Calculated Size | 590 bytes |
| Instructions    | 124       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0000:    03 00 00 00 80 41 01  80 01 80 02 10 01 00 41   .....A........A
0010: 02 80 03 80 02 10 02 00  41 04 80 05 80 02 10 09  ........A.......
0020: 00 03 03 00 06 80 08 03  00 09 00 03 05 00 03 10  ................
0030: 03 06 00 04 10 03 07 00  05 10 41 01 80 01 80 06  ..........A.....
0040: 10 08 00 20 01 1C 07 80  1E F0 FF FF 7F 6F 70 1D  ... .........op.
0050: 08 80 23 02 02 00 02 80  80 63 00 03 04 00 09 80  ..#......c......
0060: 01 93 01 02 02 00 0A 80  80 73 00 03 04 00 0B 80  .........s......
0070: 01 93 01 02 02 00 0C 80  80 83 00 03 04 00 0D 80  ................
0080: 01 93 01 02 02 00 0E 80  80 93 00 03 04 00 0F 80  ................
0090: 01 93 01 02 02 00 06 80  80 A3 00 03 04 00 10 80  ................
00A0: 01 93 01 02 02 00 03 80  80 B3 00 03 04 00 11 80  ................
00B0: 01 93 01 02 02 00 04 80  80 C3 00 03 04 00 12 80  ................
00C0: 01 93 01 02 02 00 00 80  80 D3 00 03 04 00 13 80  ................
00D0: 01 93 01 02 02 00 05 80  80 E3 00 03 04 00 14 80  ................
00E0: 01 93 01 02 02 00 07 80  80 F3 00 03 04 00 15 80  ................
00F0: 01 93 01 02 02 00 16 80  80 03 01 03 04 00 17 80  ................
0100: 01 93 01 02 02 00 18 80  80 13 01 03 04 00 19 80  ................
0110: 01 93 01 02 02 00 1A 80  80 23 01 03 04 00 1B 80  .........#......
0120: 01 93 01 02 02 00 1C 80  80 33 01 03 04 00 1D 80  .........3......
0130: 01 93 01 02 02 00 1E 80  80 43 01 03 04 00 1F 80  .........C......
0140: 01 93 01 02 02 00 20 80  80 53 01 03 04 00 21 80  ...... ..S....!.
0150: 01 93 01 02 02 00 22 80  80 63 01 03 04 00 23 80  ......"..c....#.
0160: 01 93 01 02 02 00 24 80  80 73 01 03 04 00 25 80  ......$..s....%.
0170: 01 93 01 02 02 00 26 80  80 83 01 03 04 00 27 80  ......&.......'.
0180: 01 93 01 02 02 00 28 80  80 93 01 03 04 00 29 80  ......(.......).
0190: 01 93 01 CC 01 04 00 05  00 06 00 07 00 1D 2A 80  ..............*.
01A0: 23 93 01 80 03 02 10 03  00 24 2B 80 01 80 01 80  #........$+.....
01B0: 25 02 00 10 01 80 00 FC  01 03 01 10 2C 80 43 00  %...........,.C.
01C0: 43 01 03 0A 00 02 10 02  0A 00 0C 80 00 F4 01 1D  C...............
01D0: 2D 80 23 03 01 10 2E 80  02 08 00 01 80 00 F1 01  -.#.............
01E0: 45 2C 80 F8 FF FF 7F F8  FF FF 7F 71 73 74 63 01  E,.........qstc.
01F0: 80 01 F9 01 03 01 10 2F  80 01 4C 02 02 00 10 02  ......./..L.....
0200: 80 00 4C 02 03 01 10 30  80 43 00 43 01 03 0A 00  ..L....0.C.C....
0210: 02 10 02 0A 00 0C 80 00  44 02 02 03 00 01 80 02  ........D.......
0220: 32 02 1D 31 80 23 1D 32  80 23 03 01 10 33 80 01  2..1.#.2.#...3..
0230: 41 02 1D 34 80 23 1D 35  80 23 1D 36 80 23 01 A4  A..4.#.5.#.6.#..
0240: 01 01 49 02 03 01 10 2F  80 01 4C 02 42 21 00     ..I..../..L.B!. 
```

## Opcodes

```
  0: 0x0001 [0x03] ExtData[1]->WorkLocal[0] = 8*
  1: 0x0006 [0x41] GET_BIT_WORK_RANGE(start_bit=0*, end_bit=0*, source=Work_Zone[2], result=ExtData[1]->WorkLocal[1])
  2: 0x000F [0x41] GET_BIT_WORK_RANGE(start_bit=1*, end_bit=6*, source=Work_Zone[2], result=ExtData[1]->WorkLocal[2])
  3: 0x0018 [0x41] GET_BIT_WORK_RANGE(start_bit=7*, end_bit=9*, source=Work_Zone[2], result=ExtData[1]->WorkLocal[9])
  4: 0x0021 [0x03] ExtData[1]->WorkLocal[3] = 5*
  5: 0x0026 [0x08] ExtData[1]->WorkLocal[3] -= ExtData[1]->WorkLocal[9]
  6: 0x002B [0x03] ExtData[1]->WorkLocal[5] = Work_Zone[3]
  7: 0x0030 [0x03] ExtData[1]->WorkLocal[6] = Work_Zone[4]
  8: 0x0035 [0x03] ExtData[1]->WorkLocal[7] = Work_Zone[5]
  9: 0x003A [0x41] GET_BIT_WORK_RANGE(start_bit=0*, end_bit=0*, source=Work_Zone[6], result=ExtData[1]->WorkLocal[8])
 10: 0x0043 [0x20] SET_CLI_EVENT_UC_FLAG: Lock player control
 11: 0x0045 [0x1C] WAIT(10* ticks)
 12: 0x0048 [0x1E] EventEntity looks at LocalPlayer and starts talking
 13: 0x004D [0x6F] WAIT_FRAME_DELAY: Yield until WaitTime reaches zero
 14: 0x004E [0x70] WAIT_ENTITY_RENDER_FLAG: Wait while EventEntity->Render.Flags3 bit 2 is set (cancel turn if not)
 15: 0x004F [0x1D] PRINT_EVENT_MESSAGE(message_id=7995*)
    → "By my troth, what a thrilling battle! When thou landed the felling blow, a shiver ran down my wings!\u0007As promised, here is thy reward.\u007F1\u0000\u0007"
 16: 0x0052 [0x23] WAIT_FOR_DIALOG_INTERACTION
 17: 0x0053 [0x02] IF !(ExtData[1]->WorkLocal[2] == 1*) GOTO 0x0063
 18: 0x005B [0x03] ExtData[1]->WorkLocal[4] = 18505*
 19: 0x0060 [0x01] GOTO 0x0193

SUBROUTINE_0063:
 20: 0x0063 [0x02] IF !(ExtData[1]->WorkLocal[2] == 2*) GOTO 0x0073
 21: 0x006B [0x03] ExtData[1]->WorkLocal[4] = 18764*
 22: 0x0070 [0x01] GOTO 0x0193

SUBROUTINE_0073:
 23: 0x0073 [0x02] IF !(ExtData[1]->WorkLocal[2] == 3*) GOTO 0x0083
 24: 0x007B [0x03] ExtData[1]->WorkLocal[4] = 18870*
 25: 0x0080 [0x01] GOTO 0x0193

SUBROUTINE_0083:
 26: 0x0083 [0x02] IF !(ExtData[1]->WorkLocal[2] == 4*) GOTO 0x0093
 27: 0x008B [0x03] ExtData[1]->WorkLocal[4] = 18954*
 28: 0x0090 [0x01] GOTO 0x0193

SUBROUTINE_0093:
 29: 0x0093 [0x02] IF !(ExtData[1]->WorkLocal[2] == 5*) GOTO 0x00A3
 30: 0x009B [0x03] ExtData[1]->WorkLocal[4] = 17761*
 31: 0x00A0 [0x01] GOTO 0x0193

SUBROUTINE_00A3:
 32: 0x00A3 [0x02] IF !(ExtData[1]->WorkLocal[2] == 6*) GOTO 0x00B3
 33: 0x00AB [0x03] ExtData[1]->WorkLocal[4] = 19115*
 34: 0x00B0 [0x01] GOTO 0x0193

SUBROUTINE_00B3:
 35: 0x00B3 [0x02] IF !(ExtData[1]->WorkLocal[2] == 7*) GOTO 0x00C3
 36: 0x00BB [0x03] ExtData[1]->WorkLocal[4] = 17762*
 37: 0x00C0 [0x01] GOTO 0x0193

SUBROUTINE_00C3:
 38: 0x00C3 [0x02] IF !(ExtData[1]->WorkLocal[2] == 8*) GOTO 0x00D3
 39: 0x00CB [0x03] ExtData[1]->WorkLocal[4] = 18955*
 40: 0x00D0 [0x01] GOTO 0x0193

SUBROUTINE_00D3:
 41: 0x00D3 [0x02] IF !(ExtData[1]->WorkLocal[2] == 9*) GOTO 0x00E3
 42: 0x00DB [0x03] ExtData[1]->WorkLocal[4] = 17966*
 43: 0x00E0 [0x01] GOTO 0x0193

SUBROUTINE_00E3:
 44: 0x00E3 [0x02] IF !(ExtData[1]->WorkLocal[2] == 10*) GOTO 0x00F3
 45: 0x00EB [0x03] ExtData[1]->WorkLocal[4] = 19116*
 46: 0x00F0 [0x01] GOTO 0x0193

SUBROUTINE_00F3:
 47: 0x00F3 [0x02] IF !(ExtData[1]->WorkLocal[2] == 11*) GOTO 0x0103
 48: 0x00FB [0x03] ExtData[1]->WorkLocal[4] = 18736*
 49: 0x0100 [0x01] GOTO 0x0193

SUBROUTINE_0103:
 50: 0x0103 [0x02] IF !(ExtData[1]->WorkLocal[2] == 12*) GOTO 0x0113
 51: 0x010B [0x03] ExtData[1]->WorkLocal[4] = 18452*
 52: 0x0110 [0x01] GOTO 0x0193

SUBROUTINE_0113:
 53: 0x0113 [0x02] IF !(ExtData[1]->WorkLocal[2] == 13*) GOTO 0x0123
 54: 0x011B [0x03] ExtData[1]->WorkLocal[4] = 19275*
 55: 0x0120 [0x01] GOTO 0x0193

SUBROUTINE_0123:
 56: 0x0123 [0x02] IF !(ExtData[1]->WorkLocal[2] == 14*) GOTO 0x0133
 57: 0x012B [0x03] ExtData[1]->WorkLocal[4] = 19303*
 58: 0x0130 [0x01] GOTO 0x0193

SUBROUTINE_0133:
 59: 0x0133 [0x02] IF !(ExtData[1]->WorkLocal[2] == 15*) GOTO 0x0143
 60: 0x013B [0x03] ExtData[1]->WorkLocal[4] = 18601*
 61: 0x0140 [0x01] GOTO 0x0193

SUBROUTINE_0143:
 62: 0x0143 [0x02] IF !(ExtData[1]->WorkLocal[2] == 16*) GOTO 0x0153
 63: 0x014B [0x03] ExtData[1]->WorkLocal[4] = 17763*
 64: 0x0150 [0x01] GOTO 0x0193

SUBROUTINE_0153:
 65: 0x0153 [0x02] IF !(ExtData[1]->WorkLocal[2] == 17*) GOTO 0x0163
 66: 0x015B [0x03] ExtData[1]->WorkLocal[4] = 18737*
 67: 0x0160 [0x01] GOTO 0x0193

SUBROUTINE_0163:
 68: 0x0163 [0x02] IF !(ExtData[1]->WorkLocal[2] == 18*) GOTO 0x0173
 69: 0x016B [0x03] ExtData[1]->WorkLocal[4] = 18765*
 70: 0x0170 [0x01] GOTO 0x0193

SUBROUTINE_0173:
 71: 0x0173 [0x02] IF !(ExtData[1]->WorkLocal[2] == 19*) GOTO 0x0183
 72: 0x017B [0x03] ExtData[1]->WorkLocal[4] = 19117*
 73: 0x0180 [0x01] GOTO 0x0193

SUBROUTINE_0183:
 74: 0x0183 [0x02] IF !(ExtData[1]->WorkLocal[2] == 20*) GOTO 0x0193
 75: 0x018B [0x03] ExtData[1]->WorkLocal[4] = 18602*
 76: 0x0190 [0x01] GOTO 0x0193

SUBROUTINE_0193:
 77: 0x0193 [0xCC] ITEM_INFO_WINDOW_HANDLER(case=0x01 - Open item info window (with chase), check_value=ExtData[1]->WorkLocal[4], buffer1=ExtData[1]->WorkLocal[5], buffer2=ExtData[1]->WorkLocal[6], buffer3=ExtData[1]->WorkLocal[7])
 78: 0x019D [0x1D] PRINT_EVENT_MESSAGE(message_id=7996*)
    → "Dost thou find this enchantment to thy liking?\u007F1\u0000\u0007"
 79: 0x01A0 [0x23] WAIT_FOR_DIALOG_INTERACTION
 80: 0x01A1 [0x93] DISPLAY_ITEM_INFO(item_id=0*)
 81: 0x01A4 [0x03] Work_Zone[2] = ExtData[1]->WorkLocal[3]
 82: 0x01A9 [0x24] CREATE_DIALOG(message_id=7997*, default_option=0*, option_flags=0*)
    → "Accept the item?\u0007\u000BAccept.\u0007Refuse. (
\u0000 times remaining)\u007F1\u0000\u0007"
 83: 0x01B0 [0x25] WAIT_DIALOG_SELECT()
 84: 0x01B1 [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x01FC
 85: 0x01B9 [0x03] Work_Zone[1] = 201*
 86: 0x01BE [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 87: 0x01C0 [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 88: 0x01C2 [0x03] ExtData[1]->WorkLocal[10] = Work_Zone[2]
 89: 0x01C7 [0x02] IF !(ExtData[1]->WorkLocal[10] == 3*) GOTO 0x01F4
 90: 0x01CF [0x1D] PRINT_EVENT_MESSAGE(message_id=7998*)
    → "Splendid!\u0007May it serve thee well.\u007F1\u0000\u0007"
 91: 0x01D2 [0x23] WAIT_FOR_DIALOG_INTERACTION
 92: 0x01D3 [0x03] Work_Zone[1] = 101*
 93: 0x01D8 [0x02] IF !(ExtData[1]->WorkLocal[8] == 0*) GOTO 0x01F1
 94: 0x01E0 [0x45] LOAD_SCHEDULED_TASK(work_offset1=201*, entity1=EventEntity, entity2=EventEntity, scheduler_id="qstc", work_offset2=0*)
 95: 0x01F1 [0x01] GOTO 0x01F9

SUBROUTINE_01F4:
 96: 0x01F4 [0x03] Work_Zone[1] = 999*
 97: 0x01F9 [0x01] GOTO 0x024C

SUBROUTINE_01FC:
 98: 0x01FC [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x024C
 99: 0x0204 [0x03] Work_Zone[1] = 202*
100: 0x0209 [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
101: 0x020B [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
102: 0x020D [0x03] ExtData[1]->WorkLocal[10] = Work_Zone[2]
103: 0x0212 [0x02] IF !(ExtData[1]->WorkLocal[10] == 3*) GOTO 0x0244
104: 0x021A [0x02] IF !(ExtData[1]->WorkLocal[3] <= 0*) GOTO 0x0232
105: 0x0222 [0x1D] PRINT_EVENT_MESSAGE(message_id=8000*)
    → "Ah, 'tis unfortunate.\u0007Sadly, my folk are not well-versed in the penchants of adventurers these days...\u007F1\u0000\u0007"
106: 0x0225 [0x23] WAIT_FOR_DIALOG_INTERACTION
107: 0x0226 [0x1D] PRINT_EVENT_MESSAGE(message_id=8001*)
    → "In that event, we shall prepare thy weapon to be enchanted anew.\u0007May thou be once more triumphant in battle anon!\u007F1\u0000\u0007"
108: 0x0229 [0x23] WAIT_FOR_DIALOG_INTERACTION
109: 0x022A [0x03] Work_Zone[1] = 102*
110: 0x022F [0x01] GOTO 0x0241

SUBROUTINE_0232:
111: 0x0232 [0x1D] PRINT_EVENT_MESSAGE(message_id=8002*)
    → "What's this?\u0007'Twould appear that thy weapon can endure no further enchantments.\u007F1\u0000\u0007"
112: 0x0235 [0x23] WAIT_FOR_DIALOG_INTERACTION
113: 0x0236 [0x1D] PRINT_EVENT_MESSAGE(message_id=8003*)
    → "Though it may fall short of thy expectations, pray accept it.\u007F1\u0000\u0007"
114: 0x0239 [0x23] WAIT_FOR_DIALOG_INTERACTION
115: 0x023A [0x1D] PRINT_EVENT_MESSAGE(message_id=8004*)
    → "Otherwise, we shall have no choice but to dispose of it.\u007F1\u0000\u0007"
116: 0x023D [0x23] WAIT_FOR_DIALOG_INTERACTION
117: 0x023E [0x01] GOTO 0x01A4

SUBROUTINE_0241:
118: 0x0241 [0x01] GOTO 0x0249

SUBROUTINE_0244:
119: 0x0244 [0x03] Work_Zone[1] = 999*
120: 0x0249 [0x01] GOTO 0x024C

SUBROUTINE_024C:
121: 0x024C [0x42] SET_CLI_EVENT_CANCEL_DATA()
122: 0x024D [0x21] END_EVENT
123: 0x024E [0x00] END_REQSTACK()
```
