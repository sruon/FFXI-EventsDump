# 17387990 - Bernal

## Common Data

| Field            | Value           |
|------------------|-----------------|
| Zone             | Davoi (ID: 149) |
| Block Size       | 496 bytes       |
| Total Events     | 6               |
| References Count | 16              |

## List of Events

| Event ID              | Entrypoint   |   Size |   Instructions |
|-----------------------|--------------|--------|----------------|
| [65535](#event-65535) | 0x0000       |      1 |              1 |
| [30](#event-30)       | 0x0001       |     38 |              7 |
| [31](#event-31)       | 0x0027       |     34 |             10 |
| [43](#event-43)       | 0x0049       |     66 |             13 |
| [33](#event-33)       | 0x008B       |    126 |             22 |
| [34](#event-34)       | 0x0109       |    126 |             22 |

## DAT References (imed_data)

|   Index | Hex Value   |   Dec Value |
|---------|-------------|-------------|
|       0 | 0xFFFE1E34  |  4294843956 |
|       1 | 0x0014      |          20 |
|       2 | 0x1CD8      |        7384 |
|       3 | 0x1CD9      |        7385 |
|       4 | 0x1CDA      |        7386 |
|       5 | 0x1CDE      |        7390 |
|       6 | 0x1CDB      |        7387 |
|       7 | 0x1CDC      |        7388 |
|       8 | 0x1CE3      |        7395 |
|       9 | 0x0000      |           0 |
|      10 | 0x0004      |           4 |
|      11 | 0x00C8      |         200 |
|      12 | 0x003C      |          60 |
|      13 | 0x0001      |           1 |
|      14 | 0x1CDD      |        7389 |
|      15 | 0x1CE4      |        7396 |

## String References

- **7384**: I am Bernal, of the Royal Knights of San d'Oria.
- **7385**: The mage in this tower has trapped the Orc lord inside a cave to the south. Now we just wait for reinforcements.
- **7386**: Actually, my friend Quemaricond left for the homeland quite some time ago. I do hope the message made it through.
- **7387**: Incidentally...
- **7388**: Have you business at the tower?
- **7389**: You've finished what you came here to do?
- **7390**: I cannot leave my post, but I pray for your success. Pick your fights wisely, and be not afraid to run if your enemy outnumbers you.
- **7395**: Enter the tower? [Yes./No.]
- **7396**: Leave the tower? [Yes./No.]

## Events

### Event 65535

#### Metadata

| Field        | Value   |
|--------------|---------|
| Entrypoint   | 0x0000  |
| Data Size    | 1 bytes |
| Instructions | 1       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0000: 00                                                .               
```

#### Opcodes

```
  0: 0x0000 [0x00] END_REQSTACK()
```

### Event 30

#### Metadata

| Field        | Value    |
|--------------|----------|
| Entrypoint   | 0x0001   |
| Data Size    | 38 bytes |
| Instructions | 7        |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0000:    3B F0 FF FF 7F 00 00  01 00 02 00 02 01 00 00   ;..............
0010: 80 02 1E 00 29 03 D6 51  09 01 05 01 25 00 29 03  ....)..Q....%.).
0020: D6 51 09 01 04 21 00                              .Q...!.         
```

#### Opcodes

```
  0: 0x0001 [0x3B] GET_ENTITY_POSITION(entity=LocalPlayer, x_destination=ExtData[1]->WorkLocal[0], y_destination=ExtData[1]->WorkLocal[1], z_destination=ExtData[1]->WorkLocal[2])
  1: 0x000C [0x02] IF !(ExtData[1]->WorkLocal[1] <= 4294843956*) GOTO 0x001E
  2: 0x0014 [0x29] REQ_SET_WAIT(priority=0x03, entity_id=Bernal (ID: 17387990/0x010951D6), tag_num=0x05)
  3: 0x001B [0x01] GOTO 0x0025
  4: 0x001E [0x29] REQ_SET_WAIT(priority=0x03, entity_id=Bernal (ID: 17387990/0x010951D6), tag_num=0x04)

SUBROUTINE_0025:
  5: 0x0025 [0x21] END_EVENT
  6: 0x0026 [0x00] END_REQSTACK()
```

### Event 31

#### Metadata

| Field        | Value    |
|--------------|----------|
| Entrypoint   | 0x0027   |
| Data Size    | 34 bytes |
| Instructions | 10       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0020:                      1E  F0 FF FF 7F 66 01 80 F8         .....f...
0030: FF FF 7F F8 FF FF 7F 74  6C 6B 30 1D 02 80 23 1D  .......tlk0...#.
0040: 03 80 23 1D 04 80 23 21  00                       ..#...#!.       
```

#### Opcodes

```
  0: 0x0027 [0x1E] EventEntity looks at LocalPlayer and starts talking
  1: 0x002C [0x66] LOAD_EXT_SCHEDULER_MAIN: Load scheduler "tlk0" with entities [EventEntity, EventEntity], work=20*
  2: 0x003B [0x1D] PRINT_EVENT_MESSAGE(message_id=7384*)
    → "I am Bernal, of the Royal Knights of San d'Oria."
  3: 0x003E [0x23] WAIT_FOR_DIALOG_INTERACTION
  4: 0x003F [0x1D] PRINT_EVENT_MESSAGE(message_id=7385*)
    → "The mage in this tower has trapped the Orc lord inside a cave to the south. Now we just wait for reinforcements."
  5: 0x0042 [0x23] WAIT_FOR_DIALOG_INTERACTION
  6: 0x0043 [0x1D] PRINT_EVENT_MESSAGE(message_id=7386*)
    → "Actually, my friend Quemaricond left for the homeland quite some time ago. I do hope the message made it through."
  7: 0x0046 [0x23] WAIT_FOR_DIALOG_INTERACTION
  8: 0x0047 [0x21] END_EVENT
  9: 0x0048 [0x00] END_REQSTACK()
```

### Event 43

#### Metadata

| Field        | Value    |
|--------------|----------|
| Entrypoint   | 0x0049   |
| Data Size    | 66 bytes |
| Instructions | 13       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0040:                             3B F0 FF FF 7F 00 00           ;......
0050: 01 00 02 00 02 01 00 00  80 02 66 00 29 03 D6 51  ..........f.)..Q
0060: 09 01 05 01 89 00 1E F0  FF FF 7F 66 01 80 F8 FF  ...........f....
0070: FF 7F F8 FF FF 7F 74 6C  6B 30 1D 05 80 23 1D 06  ......tlk0...#..
0080: 80 23 29 03 D6 51 09 01  04 21 00                 .#)..Q...!.     
```

#### Opcodes

```
  0: 0x0049 [0x3B] GET_ENTITY_POSITION(entity=LocalPlayer, x_destination=ExtData[1]->WorkLocal[0], y_destination=ExtData[1]->WorkLocal[1], z_destination=ExtData[1]->WorkLocal[2])
  1: 0x0054 [0x02] IF !(ExtData[1]->WorkLocal[1] <= 4294843956*) GOTO 0x0066
  2: 0x005C [0x29] REQ_SET_WAIT(priority=0x03, entity_id=Bernal (ID: 17387990/0x010951D6), tag_num=0x05)
  3: 0x0063 [0x01] GOTO 0x0089
  4: 0x0066 [0x1E] EventEntity looks at LocalPlayer and starts talking
  5: 0x006B [0x66] LOAD_EXT_SCHEDULER_MAIN: Load scheduler "tlk0" with entities [EventEntity, EventEntity], work=20*
  6: 0x007A [0x1D] PRINT_EVENT_MESSAGE(message_id=7390*)
    → "I cannot leave my post, but I pray for your success. Pick your fights wisely, and be not afraid to run if your enemy outnumbers you."
  7: 0x007D [0x23] WAIT_FOR_DIALOG_INTERACTION
  8: 0x007E [0x1D] PRINT_EVENT_MESSAGE(message_id=7387*)
    → "Incidentally..."
  9: 0x0081 [0x23] WAIT_FOR_DIALOG_INTERACTION
 10: 0x0082 [0x29] REQ_SET_WAIT(priority=0x03, entity_id=Bernal (ID: 17387990/0x010951D6), tag_num=0x04)

SUBROUTINE_0089:
 11: 0x0089 [0x21] END_EVENT
 12: 0x008A [0x00] END_REQSTACK()
```

### Event 33

#### Metadata

| Field        | Value     |
|--------------|-----------|
| Entrypoint   | 0x008B    |
| Data Size    | 126 bytes |
| Instructions | 22        |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0080:                                   1E F0 FF FF 7F             .....
0090: 66 01 80 F8 FF FF 7F F8  FF FF 7F 74 6C 6B 30 1D  f..........tlk0.
00A0: 07 80 23 66 01 80 F8 FF  FF 7F F8 FF FF 7F 74 6C  ..#f..........tl
00B0: 6B 31 24 08 80 09 80 09  80 25 02 00 10 09 80 00  k1$......%......
00C0: FC 00 42 43 00 43 01 38  0A 80 45 0B 80 F0 FF FF  ..BC.C.8..E.....
00D0: 7F F0 FF FF 7F 66 64 6F  31 09 80 1C 0C 80 29 03  .....fdo1.....).
00E0: F0 FF FF 7F 02 45 0B 80  F0 FF FF 7F F0 FF FF 7F  .....E..........
00F0: 66 64 69 31 09 80 1C 0C  80 01 07 01 02 00 10 0D  fdi1............
0100: 80 00 07 01 01 07 01 21  00                       .......!.       
```

#### Opcodes

```
  0: 0x008B [0x1E] EventEntity looks at LocalPlayer and starts talking
  1: 0x0090 [0x66] LOAD_EXT_SCHEDULER_MAIN: Load scheduler "tlk0" with entities [EventEntity, EventEntity], work=20*
  2: 0x009F [0x1D] PRINT_EVENT_MESSAGE(message_id=7388*)
    → "Have you business at the tower?"
  3: 0x00A2 [0x23] WAIT_FOR_DIALOG_INTERACTION
  4: 0x00A3 [0x66] LOAD_EXT_SCHEDULER_MAIN: Load scheduler "tlk1" with entities [EventEntity, EventEntity], work=20*
  5: 0x00B2 [0x24] CREATE_DIALOG(message_id=7395*, default_option=0*, option_flags=0*)
    → "Enter the tower? [Yes./No.]"
  6: 0x00B9 [0x25] WAIT_DIALOG_SELECT()
  7: 0x00BA [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x00FC
  8: 0x00C2 [0x42] SET_CLI_EVENT_CANCEL_DATA()
  9: 0x00C3 [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 10: 0x00C5 [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 11: 0x00C7 [0x38] SET_CLIENT_EVENT_MODE(mode=4*)
 12: 0x00CA [0x45] LOAD_SCHEDULED_TASK: Load scheduler "fdo1" with entities [LocalPlayer, LocalPlayer], work=[200*, 0*]
 13: 0x00DB [0x1C] WAIT(60* ticks)
 14: 0x00DE [0x29] REQ_SET_WAIT(priority=0x03, entity_id=LocalPlayer, tag_num=0x02)
 15: 0x00E5 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "fdi1" with entities [LocalPlayer, LocalPlayer], work=[200*, 0*]
 16: 0x00F6 [0x1C] WAIT(60* ticks)
 17: 0x00F9 [0x01] GOTO 0x0107
 18: 0x00FC [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x0107
 19: 0x0104 [0x01] GOTO 0x0107

SUBROUTINE_0107:
 20: 0x0107 [0x21] END_EVENT
 21: 0x0108 [0x00] END_REQSTACK()
```

### Event 34

#### Metadata

| Field        | Value     |
|--------------|-----------|
| Entrypoint   | 0x0109    |
| Data Size    | 126 bytes |
| Instructions | 22        |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0100:                             1E F0 FF FF 7F 66 01           .....f.
0110: 80 F8 FF FF 7F F8 FF FF  7F 74 6C 6B 30 1D 0E 80  .........tlk0...
0120: 23 66 01 80 F8 FF FF 7F  F8 FF FF 7F 74 6C 6B 31  #f..........tlk1
0130: 24 0F 80 09 80 09 80 25  02 00 10 09 80 00 7A 01  $......%......z.
0140: 42 43 00 43 01 38 0A 80  45 0B 80 F0 FF FF 7F F0  BC.C.8..E.......
0150: FF FF 7F 66 64 6F 31 09  80 1C 0C 80 29 03 F0 FF  ...fdo1.....)...
0160: FF 7F 03 45 0B 80 F0 FF  FF 7F F0 FF FF 7F 66 64  ...E..........fd
0170: 69 31 09 80 1C 0C 80 01  85 01 02 00 10 0D 80 00  i1..............
0180: 85 01 01 85 01 21 00                              .....!.         
```

#### Opcodes

```
  0: 0x0109 [0x1E] EventEntity looks at LocalPlayer and starts talking
  1: 0x010E [0x66] LOAD_EXT_SCHEDULER_MAIN: Load scheduler "tlk0" with entities [EventEntity, EventEntity], work=20*
  2: 0x011D [0x1D] PRINT_EVENT_MESSAGE(message_id=7389*)
    → "You've finished what you came here to do?"
  3: 0x0120 [0x23] WAIT_FOR_DIALOG_INTERACTION
  4: 0x0121 [0x66] LOAD_EXT_SCHEDULER_MAIN: Load scheduler "tlk1" with entities [EventEntity, EventEntity], work=20*
  5: 0x0130 [0x24] CREATE_DIALOG(message_id=7396*, default_option=0*, option_flags=0*)
    → "Leave the tower? [Yes./No.]"
  6: 0x0137 [0x25] WAIT_DIALOG_SELECT()
  7: 0x0138 [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x017A
  8: 0x0140 [0x42] SET_CLI_EVENT_CANCEL_DATA()
  9: 0x0141 [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 10: 0x0143 [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 11: 0x0145 [0x38] SET_CLIENT_EVENT_MODE(mode=4*)
 12: 0x0148 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "fdo1" with entities [LocalPlayer, LocalPlayer], work=[200*, 0*]
 13: 0x0159 [0x1C] WAIT(60* ticks)
 14: 0x015C [0x29] REQ_SET_WAIT(priority=0x03, entity_id=LocalPlayer, tag_num=0x03)
 15: 0x0163 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "fdi1" with entities [LocalPlayer, LocalPlayer], work=[200*, 0*]
 16: 0x0174 [0x1C] WAIT(60* ticks)
 17: 0x0177 [0x01] GOTO 0x0185
 18: 0x017A [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x0185
 19: 0x0182 [0x01] GOTO 0x0185

SUBROUTINE_0185:
 20: 0x0185 [0x21] END_EVENT
 21: 0x0186 [0x00] END_REQSTACK()
```
