# Event 504

## Metadata

| Field           | Value     |
|-----------------|-----------|
| Event Index     | 4/4       |
| Offset          | 0x08FE    |
| Data Size       | 788 bytes |
| Calculated Size | 788 bytes |
| Instructions    | 163       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
08F0:                                            42 4A                BJ
0900: F8 FF FF 7F F0 FF FF 7F  03 02 10 03 80 03 44 00  ..............D.
0910: 09 10 1D 43 80 23 1D 44  80 23 03 42 00 00 80 02  ...C.#.D.#.B....
0920: 08 10 00 80 00 2F 09 03  17 17 00 80 01 34 09 03  ...../.......4..
0930: 17 17 01 80 03 01 10 1A  80 43 00 43 01 02 09 10  .........C.C....
0940: 00 80 00 BD 09 02 02 10  00 80 80 6B 09 1D 45 80  ...........k..E.
0950: 23 1D 46 80 23 03 01 00  02 10 03 43 00 02 10 0B  #.F.#......C....
0960: 43 00 1A 11 04 1A 32 0A  01 BA 09 02 02 10 01 80  C.....2.........
0970: 80 91 09 1D 47 80 23 1D  48 80 23 03 01 00 02 10  ....G.#.H.#.....
0980: 03 43 00 02 10 0B 43 00  1A 11 04 1A 32 0A 01 BA  .C....C.....2...
0990: 09 02 02 10 0B 80 80 B7  09 1D 49 80 23 1D 4A 80  ..........I.#.J.
09A0: 23 03 01 00 02 10 03 43  00 02 10 0B 43 00 1A 11  #......C....C...
09B0: 04 1A 32 0A 01 BA 09 1A  E0 09 01 DE 09 02 09 10  ..2.............
09C0: 3B 80 00 CB 09 1A E0 09  01 DE 09 02 09 10 4B 80  ;.............K.
09D0: 00 D9 09 1A E0 09 01 DE  09 03 01 10 28 80 21 00  ............(.!.
09E0: 03 16 17 01 80 1D 4C 80  23 1D 4D 80 23 03 02 10  ......L.#.M.#...
09F0: 4E 80 1D 4F 80 23 03 0E  17 4E 80 24 50 80 00 80  N..O.#...N.$P...
0A00: 0B 80 25 02 00 10 00 80  00 1A 0A 1D 51 80 23 03  ..%.........Q.#.
0A10: 01 10 29 80 06 00 00 01  31 0A 02 00 10 01 80 00  ..).....1.......
0A20: 25 0A 01 31 0A 1D 52 80  23 03 01 10 2A 80 06 00  %..1..R.#...*...
0A30: 00 1B 1D 53 80 23 03 00  00 01 80 06 14 00 02 00  ...S.#..........
0A40: 00 00 80 02 11 0C 1A C5  05 03 0D 17 01 00 0B 0D  ................
0A50: 17 D4 03 01 80 03 10 D4  03 0B 80 04 10 D4 03 17  ................
0A60: 80 05 10 D4 03 1E 80 06  10 D4 03 28 80 07 10 D4  ...........(....
0A70: 03 29 80 08 10 D4 03 2A  80 09 10 D4 03 1A 80 00  .).....*........
0A80: 17 D4 03 06 80 01 17 D4  03 08 80 02 17 D4 03 2B  ...............+
0A90: 80 03 17 D4 03 2C 80 04  17 D4 03 2D 80 05 17 D4  .....,.....-....
0AA0: 03 2E 80 06 17 D4 03 2F  80 07 17 D4 03 30 80 08  ......./.....0..
0AB0: 17 D4 03 31 80 09 17 D4  03 32 80 0A 17 D4 03 33  ...1.....2.....3
0AC0: 80 0B 17 D4 03 34 80 0C  17 03 0D 17 43 00 02 42  .....4......C..B
0AD0: 00 00 80 00 FD 0A 02 40  00 34 80 05 E5 0A 3C 0E  .......@.4....<.
0AE0: 00 35 80 01 80 02 17 00  00 80 00 FA 0A D4 03 00  .5..............
0AF0: 80 00 80 3C 0E 00 00 80  01 80 01 0A 0B D4 03 00  ...<............
0B00: 80 02 10 3C 0E 00 00 80  01 80 03 0E 17 42 00 D4  ...<.........B..
0B10: 02 54 80 00 80 0E 00 25  02 00 10 00 80 00 70 0B  .T.....%......p.
0B20: 03 14 00 00 10 24 55 80  01 80 00 80 25 02 00 10  .....$U.....%...
0B30: 00 80 00 56 0B 1D 51 80  23 03 01 10 1E 80 40 1A  ...V..Q.#.....@.
0B40: 80 2F 80 01 10 00 80 40  30 80 1B 80 01 10 14 00  ./.....@0.......
0B50: 0C 00 00 01 6D 0B 02 00  10 01 80 00 61 0B 01 6D  ....m.......a..m
0B60: 0B 1D 52 80 23 0C 00 00  03 01 10 28 80 01 0B 0C  ..R.#......(....
0B70: 02 00 10 35 80 00 83 0B  0B 42 00 0D 42 00 01 80  ...5.....B..B...
0B80: 01 0B 0C 02 00 10 38 80  00 9A 0B 0C 00 00 1D 52  ......8........R
0B90: 80 23 03 01 10 28 80 01  0B 0C 03 14 00 00 10 9D  .#...(..........
0BA0: 00 44 07 0E 17 00 10 93  0E 17 1D 39 80 23 93 00  .D.........9.#..
0BB0: 80 24 50 80 01 80 00 80  25 02 00 10 00 80 00 F1  .$P.....%.......
0BC0: 0B 1D 51 80 23 03 45 00  42 00 14 45 00 34 80 07  ..Q.#.E.B..E.4..
0BD0: 45 00 14 00 03 01 10 1E  80 40 1A 80 2F 80 01 10  E........@../...
0BE0: 0E 17 40 30 80 1B 80 01  10 45 00 0C 00 00 01 0B  ..@0.....E......
0BF0: 0C 02 00 10 01 80 00 FC  0B 01 0B 0C 1D 52 80 23  .............R.#
0C00: 0C 00 00 03 01 10 28 80  0C 00 00 06 14 00 01 3E  ......(........>
0C10: 0A 1B                                             ..              
```

## Opcodes

```
  0: 0x08FE [0x42] SET_CLI_EVENT_CANCEL_DATA()
  1: 0x08FF [0x4A] EventEntity looks at LocalPlayer
  2: 0x0908 [0x03] Work_Zone[2] = 4089*
  3: 0x090D [0x03] ExtData[1]->WorkLocal[68] = Work_Zone[9]
  4: 0x0912 [0x1D] PRINT_EVENT_MESSAGE(message_id=9784*)
    → "Let me check the number on your \u0001\u0005#\u0002\u0000\u0000\u0000...\u007F1\u0000\u0007"
  5: 0x0915 [0x23] WAIT_FOR_DIALOG_INTERACTION
  6: 0x0916 [0x1D] PRINT_EVENT_MESSAGE(message_id=9785*)
    → "...\u007F1\u0000\u0007"
  7: 0x0919 [0x23] WAIT_FOR_DIALOG_INTERACTION
  8: 0x091A [0x03] ExtData[1]->WorkLocal[66] = 0*
  9: 0x091F [0x02] IF !(Work_Zone[8] == 0*) GOTO 0x092F
 10: 0x0927 [0x03] Work_Zone_1700[23] = 0*
 11: 0x092C [0x01] GOTO 0x0934
 12: 0x092F [0x03] Work_Zone_1700[23] = 1*

SUBROUTINE_0934:
 13: 0x0934 [0x03] Work_Zone[1] = 8*
 14: 0x0939 [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 15: 0x093B [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 16: 0x093D [0x02] IF !(Work_Zone[9] == 0*) GOTO 0x09BD
 17: 0x0945 [0x02] IF !(Work_Zone[2] == 0*) GOTO 0x096B
 18: 0x094D [0x1D] PRINT_EVENT_MESSAGE(message_id=9786*)
    → "<Gasp>! \u0007It...it...it's a miracle, kupo!!!\u007F1\u0000\u0007"
 19: 0x0950 [0x23] WAIT_FOR_DIALOG_INTERACTION
 20: 0x0951 [0x1D] PRINT_EVENT_MESSAGE(message_id=9787*)
    → "You won a Rank 1 Prize!!!\u0007I-I'm so excited, I-I...k-k-k-kupoooooo!!!\u007F1\u0000\u0007"
 21: 0x0954 [0x23] WAIT_FOR_DIALOG_INTERACTION
 22: 0x0955 [0x03] ExtData[1]->WorkLocal[1] = Work_Zone[2]
 23: 0x095A [0x03] ExtData[1]->WorkLocal[67] = Work_Zone[2]
 24: 0x095F [0x0B] ExtData[1]->WorkLocal[67]++
 25: 0x0962 [0x1A] CALL_SUBROUTINE(address=0x0411)
 26: 0x0965 [0x1A] CALL_SUBROUTINE(address=0x0A32)
 27: 0x0968 [0x01] GOTO 0x09BA
 28: 0x096B [0x02] IF !(Work_Zone[2] == 1*) GOTO 0x0991
 29: 0x0973 [0x1D] PRINT_EVENT_MESSAGE(message_id=9788*)
    → "Oh my sparkling stars!!!\u0007Th-this is...!!!\u007F1\u0000\u0007"
 30: 0x0976 [0x23] WAIT_FOR_DIALOG_INTERACTION
 31: 0x0977 [0x1D] PRINT_EVENT_MESSAGE(message_id=9789*)
    → "You won a Rank 2 Prize!!!\u0007That's incredible, kupo!!!\u007F1\u0000\u0007"
 32: 0x097A [0x23] WAIT_FOR_DIALOG_INTERACTION
 33: 0x097B [0x03] ExtData[1]->WorkLocal[1] = Work_Zone[2]
 34: 0x0980 [0x03] ExtData[1]->WorkLocal[67] = Work_Zone[2]
 35: 0x0985 [0x0B] ExtData[1]->WorkLocal[67]++
 36: 0x0988 [0x1A] CALL_SUBROUTINE(address=0x0411)
 37: 0x098B [0x1A] CALL_SUBROUTINE(address=0x0A32)
 38: 0x098E [0x01] GOTO 0x09BA
 39: 0x0991 [0x02] IF !(Work_Zone[2] == 2*) GOTO 0x09B7
 40: 0x0999 [0x1D] PRINT_EVENT_MESSAGE(message_id=9790*)
    → "Wowsers! Wonderful!\u007F1\u0000\u0007"
 41: 0x099C [0x23] WAIT_FOR_DIALOG_INTERACTION
 42: 0x099D [0x1D] PRINT_EVENT_MESSAGE(message_id=9791*)
    → "You won a Rank 3 Prize!\u0007Congratulations, kupo!\u007F1\u0000\u0007"
 43: 0x09A0 [0x23] WAIT_FOR_DIALOG_INTERACTION
 44: 0x09A1 [0x03] ExtData[1]->WorkLocal[1] = Work_Zone[2]
 45: 0x09A6 [0x03] ExtData[1]->WorkLocal[67] = Work_Zone[2]
 46: 0x09AB [0x0B] ExtData[1]->WorkLocal[67]++
 47: 0x09AE [0x1A] CALL_SUBROUTINE(address=0x0411)
 48: 0x09B1 [0x1A] CALL_SUBROUTINE(address=0x0A32)
 49: 0x09B4 [0x01] GOTO 0x09BA
 50: 0x09B7 [0x1A] CALL_SUBROUTINE(address=0x09E0)

SUBROUTINE_09BA:
 51: 0x09BA [0x01] GOTO 0x09DE
 52: 0x09BD [0x02] IF !(Work_Zone[9] == 4294967295*) GOTO 0x09CB
 53: 0x09C5 [0x1A] CALL_SUBROUTINE(address=0x09E0)
 54: 0x09C8 [0x01] GOTO 0x09DE
 55: 0x09CB [0x02] IF !(Work_Zone[9] == 4294967294*) GOTO 0x09D9
 56: 0x09D3 [0x1A] CALL_SUBROUTINE(address=0x09E0)
 57: 0x09D6 [0x01] GOTO 0x09DE
 58: 0x09D9 [0x03] Work_Zone[1] = 5*

SUBROUTINE_09DE:
 59: 0x09DE [0x21] END_EVENT
 60: 0x09DF [0x00] END_REQSTACK()

SUBROUTINE_09E0:
 61: 0x09E0 [0x03] Work_Zone_1700[22] = 1*
 62: 0x09E5 [0x1D] PRINT_EVENT_MESSAGE(message_id=9796*)
    → "Hm...\u007F1\u0000\u0007"
 63: 0x09E8 [0x23] WAIT_FOR_DIALOG_INTERACTION
 64: 0x09E9 [0x1D] PRINT_EVENT_MESSAGE(message_id=9797*)
    → "I'm sorry, but you got the least-coveted Rank \u000C\u001E[6/4] Prize, kupo.\u007F1\u0000\u0007"
 65: 0x09EC [0x23] WAIT_FOR_DIALOG_INTERACTION
 66: 0x09ED [0x03] Work_Zone[2] = 18468*
 67: 0x09F2 [0x1D] PRINT_EVENT_MESSAGE(message_id=9805*)
    → "Your consolation prize is \u0001\u0001\u0001 \u0001\u0005$\u0002\u0000\u0000\u0000, kupo!\u007F1\u0000\u0007"
 68: 0x09F5 [0x23] WAIT_FOR_DIALOG_INTERACTION
 69: 0x09F6 [0x03] Work_Zone_1700[14] = 18468*
 70: 0x09FB [0x24] CREATE_DIALOG(message_id=9804*, default_option=0*, option_flags=2*)
    → "You chose \u0001\u0001\u0001 \u0001\u0005$\u0002\u0016\u0000\u0000.\u0007\u000BConfirm.\u0007Changed my mind.\u0007Choose later.\u007F1\u0000\u0007"
 71: 0x0A02 [0x25] WAIT_DIALOG_SELECT()
 72: 0x0A03 [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x0A1A
 73: 0x0A0B [0x1D] PRINT_EVENT_MESSAGE(message_id=9801*)
    → "You got it! Just a moment, kupo.\u007F1\u0000\u0007"
 74: 0x0A0E [0x23] WAIT_FOR_DIALOG_INTERACTION
 75: 0x0A0F [0x03] Work_Zone[1] = 6*
 76: 0x0A14 [0x06] ExtData[1]->WorkLocal[0] = 0
 77: 0x0A17 [0x01] GOTO 0x0A31
 78: 0x0A1A [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x0A25
 79: 0x0A22 [0x01] GOTO 0x0A31
 80: 0x0A25 [0x1D] PRINT_EVENT_MESSAGE(message_id=9802*)
    → "Understood. Please come back when you've made up your mind, kupo.\u007F1\u0000\u0007"
 81: 0x0A28 [0x23] WAIT_FOR_DIALOG_INTERACTION
 82: 0x0A29 [0x03] Work_Zone[1] = 7*
 83: 0x0A2E [0x06] ExtData[1]->WorkLocal[0] = 0

SUBROUTINE_0A31:
 84: 0x0A31 [0x1B] RETURN

SUBROUTINE_0A32:
 85: 0x0A32 [0x1D] PRINT_EVENT_MESSAGE(message_id=9798*)
    → "Please choose a prize from the following list, kupo.\u007F1\u0000\u0007"
 86: 0x0A35 [0x23] WAIT_FOR_DIALOG_INTERACTION
 87: 0x0A36 [0x03] ExtData[1]->WorkLocal[0] = 1*
 88: 0x0A3B [0x06] ExtData[1]->WorkLocal[20] = 0

SUBROUTINE_0A3E:
 89: 0x0A3E [0x02] IF !(ExtData[1]->WorkLocal[0] <= 0*) GOTO 0x0C11
 90: 0x0A46 [0x1A] CALL_SUBROUTINE(address=0x05C5)
 91: 0x0A49 [0x03] Work_Zone_1700[13] = ExtData[1]->WorkLocal[1]
 92: 0x0A4E [0x0B] Work_Zone_1700[13]++
 93: 0x0A51 [0xD4] MAP_QUERY_WINDOW: Prepare buffer configuration A (buffer=[01 80 03 10 D4 03 0B 80...])
 94: 0x0A6F [0xD4] MAP_QUERY_WINDOW: Prepare buffer configuration A (buffer=[29 80 08 10 D4 03 2A 80...])
 95: 0x0A8D [0xD4] MAP_QUERY_WINDOW: Prepare buffer configuration A (buffer=[2B 80 03 17 D4 03 2C 80...])
 96: 0x0AAB [0xD4] MAP_QUERY_WINDOW: Prepare buffer configuration A (buffer=[30 80 08 17 D4 03 31 80...])
 97: 0x0AC9 [0x03] Work_Zone_1700[13] = ExtData[1]->WorkLocal[67]
 98: 0x0ACE [0x02] IF !(ExtData[1]->WorkLocal[66] == 0*) GOTO 0x0AFD
 99: 0x0AD6 [0x02] IF !(ExtData[1]->WorkLocal[64] > 20*) GOTO 0x0AE5
100: 0x0ADE [0x3C] SET_BIT_FLAG_CONDITIONAL(target_work_offset=0x0E, bit_index_work_offset=0x8035, condition_work_offset=0x8001)
101: 0x0AE5 [0x02] IF !(ExtData[1]->WorkLocal[23] == 0*) GOTO 0x0AFA
102: 0x0AED [0xD4] MAP_QUERY_WINDOW: Prepare buffer configuration A (buffer=[00 80 00 80 3C 0E 00 00...])
103: 0x0B0B [0x0E] 0x4217 |= 0xD400
104: 0x0B10 [0x02] IF !(9799* UNKNOWN_COND_14 0*) GOTO 0x2500
105: 0x0B18 [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x0B70
106: 0x0B20 [0x03] ExtData[1]->WorkLocal[20] = Work_Zone[0]
107: 0x0B25 [0x24] CREATE_DIALOG(message_id=9803*, default_option=1*, option_flags=0*)
    → "You chose 
\u0000 gil.\u0007\u000BConfirm.\u0007Changed my mind.\u0007Choose later.\u007F1\u0000\u0007"
108: 0x0B2C [0x25] WAIT_DIALOG_SELECT()
109: 0x0B2D [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x0B56
110: 0x0B35 [0x1D] PRINT_EVENT_MESSAGE(message_id=9801*)
    → "You got it! Just a moment, kupo.\u007F1\u0000\u0007"
111: 0x0B38 [0x23] WAIT_FOR_DIALOG_INTERACTION
112: 0x0B39 [0x03] Work_Zone[1] = 4*
113: 0x0B3E [0x40] SET_BIT_WORK_RANGE(start_bit=8*, end_bit=15*, target=Work_Zone[1], source=0*)
114: 0x0B47 [0x40] SET_BIT_WORK_RANGE(start_bit=16*, end_bit=31*, target=Work_Zone[1], source=ExtData[1]->WorkLocal[20])
115: 0x0B50 [0x0C] ExtData[1]->WorkLocal[0]--
116: 0x0B53 [0x01] GOTO 0x0B6D
117: 0x0B56 [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x0B61
118: 0x0B5E [0x01] GOTO 0x0B6D
119: 0x0B61 [0x1D] PRINT_EVENT_MESSAGE(message_id=9802*)
    → "Understood. Please come back when you've made up your mind, kupo.\u007F1\u0000\u0007"
120: 0x0B64 [0x23] WAIT_FOR_DIALOG_INTERACTION
121: 0x0B65 [0x0C] ExtData[1]->WorkLocal[0]--
122: 0x0B68 [0x03] Work_Zone[1] = 5*

SUBROUTINE_0B6D:
123: 0x0B6D [0x01] GOTO 0x0C0B
124: 0x0B70 [0x02] IF !(Work_Zone[0] == 21*) GOTO 0x0B83
125: 0x0B78 [0x0B] ExtData[1]->WorkLocal[66]++
126: 0x0B7B [0x0D] ExtData[1]->WorkLocal[66] &= 1*
127: 0x0B80 [0x01] GOTO 0x0C0B
128: 0x0B83 [0x02] IF !(Work_Zone[0] == 22*) GOTO 0x0B9A
129: 0x0B8B [0x0C] ExtData[1]->WorkLocal[0]--
130: 0x0B8E [0x1D] PRINT_EVENT_MESSAGE(message_id=9802*)
    → "Understood. Please come back when you've made up your mind, kupo.\u007F1\u0000\u0007"
131: 0x0B91 [0x23] WAIT_FOR_DIALOG_INTERACTION
132: 0x0B92 [0x03] Work_Zone[1] = 5*
133: 0x0B97 [0x01] GOTO 0x0C0B
134: 0x0B9A [0x03] ExtData[1]->WorkLocal[20] = Work_Zone[0]
135: 0x0B9F [0x9D] Work_Zone_1700[14] = 0x0744[Work_Zone[0]] // Read WORD
136: 0x0BA7 [0x93] DISPLAY_ITEM_INFO(item_id=Work_Zone_1700[14])
137: 0x0BAA [0x1D] PRINT_EVENT_MESSAGE(message_id=9766*)
    → "\u007F\u0000\u0001\u0001\u0005#\u0002\u0016\u0000\u0000 is a rank 
\u0015 prize, kupo!\u007F1\u0000\u0007"
138: 0x0BAD [0x23] WAIT_FOR_DIALOG_INTERACTION
139: 0x0BAE [0x93] DISPLAY_ITEM_INFO(item_id=0*)
140: 0x0BB1 [0x24] CREATE_DIALOG(message_id=9804*, default_option=1*, option_flags=0*)
    → "You chose \u0001\u0001\u0001 \u0001\u0005$\u0002\u0016\u0000\u0000.\u0007\u000BConfirm.\u0007Changed my mind.\u0007Choose later.\u007F1\u0000\u0007"
141: 0x0BB8 [0x25] WAIT_DIALOG_SELECT()
142: 0x0BB9 [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x0BF1
143: 0x0BC1 [0x1D] PRINT_EVENT_MESSAGE(message_id=9801*)
    → "You got it! Just a moment, kupo.\u007F1\u0000\u0007"
144: 0x0BC4 [0x23] WAIT_FOR_DIALOG_INTERACTION
145: 0x0BC5 [0x03] ExtData[1]->WorkLocal[69] = ExtData[1]->WorkLocal[66]
146: 0x0BCA [0x14] ExtData[1]->WorkLocal[69] *= 20*
147: 0x0BCF [0x07] ExtData[1]->WorkLocal[69] += ExtData[1]->WorkLocal[20]
148: 0x0BD4 [0x03] Work_Zone[1] = 4*
149: 0x0BD9 [0x40] SET_BIT_WORK_RANGE(start_bit=8*, end_bit=15*, target=Work_Zone[1], source=Work_Zone_1700[14])
150: 0x0BE2 [0x40] SET_BIT_WORK_RANGE(start_bit=16*, end_bit=31*, target=Work_Zone[1], source=ExtData[1]->WorkLocal[69])
151: 0x0BEB [0x0C] ExtData[1]->WorkLocal[0]--
152: 0x0BEE [0x01] GOTO 0x0C0B
153: 0x0BF1 [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x0BFC
154: 0x0BF9 [0x01] GOTO 0x0C0B
155: 0x0BFC [0x1D] PRINT_EVENT_MESSAGE(message_id=9802*)
    → "Understood. Please come back when you've made up your mind, kupo.\u007F1\u0000\u0007"
156: 0x0BFF [0x23] WAIT_FOR_DIALOG_INTERACTION
157: 0x0C00 [0x0C] ExtData[1]->WorkLocal[0]--
158: 0x0C03 [0x03] Work_Zone[1] = 5*
159: 0x0C08 [0x0C] ExtData[1]->WorkLocal[0]--

SUBROUTINE_0C0B:
160: 0x0C0B [0x06] ExtData[1]->WorkLocal[20] = 0
161: 0x0C0E [0x01] GOTO 0x0A3E
162: 0x0C11 [0x1B] RETURN
```
