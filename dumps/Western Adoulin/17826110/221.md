# Event 221

## Metadata

| Field           | Value     |
|-----------------|-----------|
| Event Index     | 4/33      |
| Offset          | 0x136B    |
| Data Size       | 646 bytes |
| Calculated Size | 646 bytes |
| Instructions    | 120       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
1360:                                   42 1A 64 00 46             B.d.F
1370: 01 38 08 80 92 01 3F 01  10 01 94 01 3F 01 10 01  .8....?.....?...
1380: 94 01 F0 FF FF 7F BA F0  FF FF 7F 5C 80 5D 80 5E  ...........\.].^
1390: 80 5F 80 80 3F 01 10 01  80 F0 FF FF 7F 45 60 80  ._..?........E`.
13A0: F0 FF FF 7F F0 FF FF 7F  72 75 6E 31 01 80 1C 24  ........run1...$
13B0: 80 1A 43 00 06 01 10 4A  F0 FF FF 7F 3F 01 10 01  ..C....J....?...
13C0: 6F 76 F0 FF FF 7F 1C 3E  80 4A 3F 01 10 01 F0 FF  ov.....>.J?.....
13D0: FF 7F 6F 76 3F 01 10 01  02 03 10 05 80 00 FD 14  ..ov?...........
13E0: 2B 3F 01 10 01 8B 80 23  D4 03 03 80 67 80 D4 03  +?.....#....g...
13F0: 05 80 68 80 D4 03 58 80  69 80 D4 03 45 80 6A 80  ..h...X.i...E.j.
1400: D4 03 31 80 6B 80 D4 02  8C 80 01 80 05 10 25 02  ..1.k.........%.
1410: 00 10 01 80 00 7D 14 03  01 10 8D 80 45 00 80 F0  .....}......E...
1420: FF FF 7F F0 FF FF 7F 66  64 6F 31 01 80 55 00 80  .......fdo1..U..
1430: F0 FF FF 7F F0 FF FF 7F  66 64 6F 31 5C 00 48 80  ........fdo1\.H.
1440: 5C 01 48 80 9A 5D 49 80  03 80 52 60 80 F0 FF FF  \.H..]I...R`....
1450: 7F F0 FF FF 7F 72 75 6E  31 1C 24 80 AB 11 01 80  .....run1.$.....
1460: 1C 03 80 AB 0A 46 00 45  00 80 F0 FF FF 7F F0 FF  .....F.E........
1470: FF 7F 66 64 69 32 01 80  21 00 01 FA 14 02 00 10  ..fdi2..!.......
1480: 03 80 00 96 14 03 01 10  03 80 43 00 43 01 03 02  ..........C.C...
1490: 10 67 80 01 FA 14 02 00  10 05 80 00 AF 14 03 01  .g..............
14A0: 10 05 80 43 00 43 01 03  02 10 68 80 01 FA 14 02  ...C.C....h.....
14B0: 00 10 58 80 00 C8 14 03  01 10 58 80 43 00 43 01  ..X.......X.C.C.
14C0: 03 02 10 69 80 01 FA 14  02 00 10 45 80 00 E1 14  ...i.......E....
14D0: 03 01 10 45 80 43 00 43  01 03 02 10 6A 80 01 FA  ...E.C.C....j...
14E0: 14 02 00 10 31 80 00 FA  14 03 01 10 31 80 43 00  ....1.......1.C.
14F0: 43 01 03 02 10 6B 80 01  FA 14 01 4D 15 02 04 10  C....k.....M....
1500: 03 80 80 0D 15 03 02 10  67 80 01 4D 15 02 04 10  ........g..M....
1510: 05 80 80 1D 15 03 02 10  68 80 01 4D 15 02 04 10  ........h..M....
1520: 58 80 80 2D 15 03 02 10  69 80 01 4D 15 02 04 10  X..-....i..M....
1530: 45 80 80 3D 15 03 02 10  6A 80 01 4D 15 02 04 10  E..=....j..M....
1540: 31 80 80 4D 15 03 02 10  6B 80 01 4D 15 93 02 10  1..M....k..M....
1550: 2B 3F 01 10 01 8E 80 23  93 01 80 24 8F 80 01 80  +?.....#...$....
1560: 01 80 25 02 00 10 01 80  00 83 15 27 08 3F 01 10  ..%........'.?..
1570: 01 1A 2B 3F 01 10 01 90  80 2A 08 3F 01 10 01 23  ..+?.....*.?...#
1580: 01 93 15 02 00 10 03 80  00 93 15 03 01 10 8D 80  ................
1590: 01 93 15 45 00 80 F0 FF  FF 7F F0 FF FF 7F 66 64  ...E..........fd
15A0: 6F 31 01 80 55 00 80 F0  FF FF 7F F0 FF FF 7F 66  o1..U..........f
15B0: 64 6F 31 5C 00 48 80 5C  01 48 80 9A 5D 49 80 03  do1\.H.\.H..]I..
15C0: 80 52 60 80 F0 FF FF 7F  F0 FF FF 7F 72 75 6E 31  .R`.........run1
15D0: 1C 24 80 AB 11 01 80 1C  03 80 AB 0A 46 00 45 00  .$..........F.E.
15E0: 80 F0 FF FF 7F F0 FF FF  7F 66 64 69 32 01 80 21  .........fdi2..!
15F0: 00                                                .               
```

## Opcodes

```
  0: 0x136B [0x42] SET_CLI_EVENT_CANCEL_DATA()
  1: 0x136C [0x1A] CALL_SUBROUTINE(address=0x0064)
  2: 0x136F [0x46] CAMERA_CONTROL: Disable user control
  3: 0x1371 [0x38] SET_CLIENT_EVENT_MODE(mode=27*)
  4: 0x1374 [0x92] Octavernost (ID: 17826111/0x0110013F)->Render.Flags3 ^= 0x01
  5: 0x137A [0x94] Octavernost (ID: 17826111/0x0110013F)->Render.Flags3 ^= 0x01
  6: 0x1380 [0x94] LocalPlayer->Render.Flags3 ^= 0x01
  7: 0x1386 [0xBA] SET_ENTITY_POSITION(entity_id=LocalPlayer, pos_x=125.980*, pos_z=-29.512*, pos_y=3.851*, direction=89.4°*)
  8: 0x1393 [0x80] LOAD_WAIT(entity=Octavernost (ID: 17826111/0x0110013F))
  9: 0x1398 [0x80] LOAD_WAIT(entity=LocalPlayer)
 10: 0x139D [0x45] LOAD_SCHEDULED_TASK(work_offset1=709*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="run1", work_offset2=0*)
 11: 0x13AE [0x1C] WAIT(15* ticks)
 12: 0x13B1 [0x1A] CALL_SUBROUTINE(address=0x0043)
 13: 0x13B4 [0x06] Work_Zone[1] = 0
 14: 0x13B7 [0x4A] LocalPlayer looks at Octavernost (ID: 17826111/0x0110013F)
 15: 0x13C0 [0x6F] WAIT_FRAME_DELAY: Yield until WaitTime reaches zero
 16: 0x13C1 [0x76] CHECK_ENTITY_RENDER_FLAGS: Wait until LocalPlayer Render.Flags0 and Render.Flags3 conditions are met
 17: 0x13C6 [0x1C] WAIT(20* ticks)
 18: 0x13C9 [0x4A] Octavernost (ID: 17826111/0x0110013F) looks at LocalPlayer
 19: 0x13D2 [0x6F] WAIT_FRAME_DELAY: Yield until WaitTime reaches zero
 20: 0x13D3 [0x76] CHECK_ENTITY_RENDER_FLAGS: Wait until Octavernost (ID: 17826111/0x0110013F) Render.Flags0 and Render.Flags3 conditions are met
 21: 0x13D8 [0x02] IF !(Work_Zone[3] == 2*) GOTO 0x14FD
 22: 0x13E0 [0x2B] Octavernost (ID: 17826111/0x0110013F) [11990*]:
    → "Then the deal is done. Which piece would you like?\u007F1\u0000\u0007"
 23: 0x13E7 [0x23] WAIT_FOR_DIALOG_INTERACTION
 24: 0x13E8 [0xD4] MAP_QUERY_WINDOW: Prepare buffer configuration A (buffer=[03 80 67 80 D4 03 05 80...])
 25: 0x1406 [0xD4] MAP_QUERY_WINDOW: Test and open query window (flag=0x8C, work=[0x0180, 0x0580, 0x2510])
 26: 0x140F [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x147D
 27: 0x1417 [0x03] Work_Zone[1] = 9*
 28: 0x141C [0x45] LOAD_SCHEDULED_TASK(work_offset1=200*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="fdo1", work_offset2=0*)
 29: 0x142D [0x55] WAIT_LOAD_SCHEDULER(work_offset=200*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="fdo1")
 30: 0x143C [0x5C] MUSIC_CONTROL: Set Idle (Day) music to song 59*
 31: 0x1440 [0x5C] MUSIC_CONTROL: Set Idle (Night) music to song 59*
 32: 0x1444 [0x9A] WAIT_MUSIC_SERVER()
 33: 0x1445 [0x5D] SET_MUSIC_VOLUME(volume=127*, fade_time=1*)
 34: 0x144A [0x52] END_LOAD_SCHEDULER: End scheduler "run1" with entities [LocalPlayer, LocalPlayer], work=709*
 35: 0x1459 [0x1C] WAIT(15* ticks)
 36: 0x145C [0xAB] EventEntity->DespawnValue = 0* // Set despawn value
 37: 0x1460 [0x1C] WAIT(1* ticks)
 38: 0x1463 [0xAB] EventEntity->UnknownFlag = 0 // Disable unknown flag
 39: 0x1465 [0x46] CAMERA_CONTROL: Restore default settings
 40: 0x1467 [0x45] LOAD_SCHEDULED_TASK(work_offset1=200*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="fdi2", work_offset2=0*)
 41: 0x1478 [0x21] END_EVENT
 42: 0x1479 [0x00] END_REQSTACK()

SUBROUTINE_147D:
 43: 0x147D [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x1496
 44: 0x1485 [0x03] Work_Zone[1] = 1*
 45: 0x148A [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 46: 0x148C [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 47: 0x148E [0x03] Work_Zone[2] = 26782*
 48: 0x1493 [0x01] GOTO 0x14FA

SUBROUTINE_1496:
 49: 0x1496 [0x02] IF !(Work_Zone[0] == 2*) GOTO 0x14AF
 50: 0x149E [0x03] Work_Zone[1] = 2*
 51: 0x14A3 [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 52: 0x14A5 [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 53: 0x14A7 [0x03] Work_Zone[2] = 26940*
 54: 0x14AC [0x01] GOTO 0x14FA

SUBROUTINE_14AF:
 55: 0x14AF [0x02] IF !(Work_Zone[0] == 3*) GOTO 0x14C8
 56: 0x14B7 [0x03] Work_Zone[1] = 3*
 57: 0x14BC [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 58: 0x14BE [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 59: 0x14C0 [0x03] Work_Zone[2] = 27094*
 60: 0x14C5 [0x01] GOTO 0x14FA

SUBROUTINE_14C8:
 61: 0x14C8 [0x02] IF !(Work_Zone[0] == 4*) GOTO 0x14E1
 62: 0x14D0 [0x03] Work_Zone[1] = 4*
 63: 0x14D5 [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 64: 0x14D7 [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 65: 0x14D9 [0x03] Work_Zone[2] = 27279*
 66: 0x14DE [0x01] GOTO 0x14FA

SUBROUTINE_14E1:
 67: 0x14E1 [0x02] IF !(Work_Zone[0] == 5*) GOTO 0x14FA
 68: 0x14E9 [0x03] Work_Zone[1] = 5*
 69: 0x14EE [0x43] SEND_EVENT_UPDATE: Send pending tag to server (packet 0x005B)
 70: 0x14F0 [0x43] SEND_EVENT_UPDATE: Check pending flag (skip if not pending)
 71: 0x14F2 [0x03] Work_Zone[2] = 27453*
 72: 0x14F7 [0x01] GOTO 0x14FA

SUBROUTINE_14FA:
 73: 0x14FA [0x01] GOTO 0x154D

SUBROUTINE_14FD:
 74: 0x14FD [0x02] IF !(Work_Zone[4] == 1*) GOTO 0x150D
 75: 0x1505 [0x03] Work_Zone[2] = 26782*
 76: 0x150A [0x01] GOTO 0x154D

SUBROUTINE_150D:
 77: 0x150D [0x02] IF !(Work_Zone[4] == 2*) GOTO 0x151D
 78: 0x1515 [0x03] Work_Zone[2] = 26940*
 79: 0x151A [0x01] GOTO 0x154D

SUBROUTINE_151D:
 80: 0x151D [0x02] IF !(Work_Zone[4] == 3*) GOTO 0x152D
 81: 0x1525 [0x03] Work_Zone[2] = 27094*
 82: 0x152A [0x01] GOTO 0x154D

SUBROUTINE_152D:
 83: 0x152D [0x02] IF !(Work_Zone[4] == 4*) GOTO 0x153D
 84: 0x1535 [0x03] Work_Zone[2] = 27279*
 85: 0x153A [0x01] GOTO 0x154D

SUBROUTINE_153D:
 86: 0x153D [0x02] IF !(Work_Zone[4] == 5*) GOTO 0x154D
 87: 0x1545 [0x03] Work_Zone[2] = 27453*
 88: 0x154A [0x01] GOTO 0x154D

SUBROUTINE_154D:
 89: 0x154D [0x93] DISPLAY_ITEM_INFO(item_id=Work_Zone[2])
 90: 0x1550 [0x2B] Octavernost (ID: 17826111/0x0110013F) [11992*]:
    → "Ah, yes. \u007F\u0000\u0001\u0001\u0001\u0001 \u0001\u0005$\u0002\u0000\u0000\u0000. Perfect choice--but are you sure?\u007F1\u0000\u0007"
 91: 0x1557 [0x23] WAIT_FOR_DIALOG_INTERACTION
 92: 0x1558 [0x93] DISPLAY_ITEM_INFO(item_id=0*)
 93: 0x155B [0x24] CREATE_DIALOG(message_id=11993*, default_option=0*, option_flags=0*)
    → "Order \u0001\u0001\u0001 \u0001\u0005$\u0002\u0000\u0000\u0000?\u0007\u000BThat would be splendid.\u0007I need time to think.\u007F1\u0000\u0007"
 94: 0x1562 [0x25] WAIT_DIALOG_SELECT()
 95: 0x1563 [0x02] IF !(Work_Zone[0] == 0*) GOTO 0x1583
 96: 0x156B [0x27] REQ_SET(priority=0x08, entity_id=Octavernost (ID: 17826111/0x0110013F), tag_num=0x1A)
 97: 0x1572 [0x2B] Octavernost (ID: 17826111/0x0110013F) [11994*]:
    → "I shall forward your request to Amchuchu forthwith. Be warned that she may keep you waiting a tad.\u007F1\u0000\u0007"
 98: 0x1579 [0x2A] GET_REQ_LEVEL(level=8, entity_id=Octavernost (ID: 17826111/0x0110013F))
 99: 0x157F [0x23] WAIT_FOR_DIALOG_INTERACTION
100: 0x1580 [0x01] GOTO 0x1593

SUBROUTINE_1583:
101: 0x1583 [0x02] IF !(Work_Zone[0] == 1*) GOTO 0x1593
102: 0x158B [0x03] Work_Zone[1] = 9*
103: 0x1590 [0x01] GOTO 0x1593

SUBROUTINE_1593:
104: 0x1593 [0x45] LOAD_SCHEDULED_TASK(work_offset1=200*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="fdo1", work_offset2=0*)
105: 0x15A4 [0x55] WAIT_LOAD_SCHEDULER(work_offset=200*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="fdo1")
106: 0x15B3 [0x5C] MUSIC_CONTROL: Set Idle (Day) music to song 59*
107: 0x15B7 [0x5C] MUSIC_CONTROL: Set Idle (Night) music to song 59*
108: 0x15BB [0x9A] WAIT_MUSIC_SERVER()
109: 0x15BC [0x5D] SET_MUSIC_VOLUME(volume=127*, fade_time=1*)
110: 0x15C1 [0x52] END_LOAD_SCHEDULER: End scheduler "run1" with entities [LocalPlayer, LocalPlayer], work=709*
111: 0x15D0 [0x1C] WAIT(15* ticks)
112: 0x15D3 [0xAB] EventEntity->DespawnValue = 0* // Set despawn value
113: 0x15D7 [0x1C] WAIT(1* ticks)
114: 0x15DA [0xAB] EventEntity->UnknownFlag = 0 // Disable unknown flag
115: 0x15DC [0x46] CAMERA_CONTROL: Restore default settings
116: 0x15DE [0x45] LOAD_SCHEDULED_TASK(work_offset1=200*, entity1=LocalPlayer, entity2=LocalPlayer, scheduler_id="fdi2", work_offset2=0*)
117: 0x15EF [0x21] END_EVENT
118: 0x15F0 [0x00] END_REQSTACK()
```

## Data or dead code:

```
# Dead code (unreachable instructions):
     0x147A [0x01] GOTO 0x14FA
```