# Event 506

## Metadata

| Field           | Value     |
|-----------------|-----------|
| Event Index     | 2/3       |
| Offset          | 0x0001    |
| Data Size       | 843 bytes |
| Calculated Size | 843 bytes |
| Instructions    | 136       |

```
      00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F
      -- -- -- -- -- -- -- --  -- -- -- -- -- -- -- --
0000:    42 1A 54 09 46 01 38  00 80 75 00 01 80 75 01   B.T.F.8..u...u.
0010: 27 10 F0 FF FF 7F 79 27  10 1A F0 0E 01 A1 BA F0  '.....y'........
0020: FF FF 7F 02 80 03 80 04  80 05 80 BA 1A F0 0E 01  ................
0030: 06 80 07 80 04 80 08 80  80 F0 FF FF 7F 80 1A F0  ................
0040: 0E 01 1C 09 80 4A F0 FF  FF 7F 1A F0 0E 01 6F 76  .....J........ov
0050: F0 FF FF 7F 1C 0A 80 03  00 00 0B 80 02 00 00 0C  ................
0060: 80 05 EC 00 02 0D 80 00  00 04 E4 00 02 00 00 0E  ................
0070: 80 80 83 00 1A 33 09 4A  1A F0 0E 01 F0 FF FF 7F  .....3.J........
0080: 01 E4 00 02 00 00 0F 80  80 9C 00 27 10 1A F0 0E  ...........'....
0090: 01 A2 27 10 1A F0 0E 01  A4 01 E4 00 02 00 00 10  ..'.............
00A0: 80 80 AE 00 27 10 1A F0  0E 01 A3 01 E4 00 02 00  ....'...........
00B0: 00 11 80 80 C0 00 27 10  1A F0 0E 01 AD 01 E4 00  ......'.........
00C0: 02 00 00 0C 80 80 D2 00  27 10 1A F0 0E 01 AE 01  ........'.......
00D0: E4 00 02 00 00 12 80 80  E4 00 27 10 1A F0 0E 01  ..........'.....
00E0: AC 01 E4 00 07 00 00 0B  80 01 5C 00 03 00 00 0B  ..........\.....
00F0: 80 02 00 00 0C 80 05 0C  01 02 0D 80 00 00 05 04  ................
0100: 01 1A 3D 01 07 00 00 0B  80 01 F1 00 1A 54 09 1C  ..=..........T..
0110: 0A 80 5C 00 13 80 5C 01  13 80 9A 46 00 45 08 80  ..\...\....F.E..
0120: F0 FF FF 7F F0 FF FF 7F  66 64 69 32 0D 80 21 00  ........fdi2..!.
0130: 02 0D 80 0B 80 00 3C 01  48 14 80 23 1B 02 00 00  ......<.H..#....
0140: 0B 80 80 92 01 45 15 80  F0 FF FF 7F F0 FF FF 7F  .....E..........
0150: 39 30 30 31 0D 80 1A 33  09 1C 0A 80 4A 1A F0 0E  9001...3....J...
0160: 01 F0 FF FF 7F 6F 76 1A  F0 0E 01 1C 0A 80 2B 1A  .....ov.......+.
0170: F0 0E 01 14 80 23 29 10  F0 FF FF 7F 7C 1C 16 80  .....#).....|...
0180: 52 15 80 F0 FF FF 7F F0  FF FF 7F 39 30 30 31 01  R..........9001.
0190: 4B 03 02 00 00 0E 80 80  D0 01 45 15 80 F0 FF FF  K.........E.....
01A0: 7F F0 FF FF 7F 39 30 30  32 0D 80 2B 1A F0 0E 01  .....9002..+....
01B0: 17 80 23 5D 0D 80 16 80  1A 54 09 1C 0A 80 52 15  ..#].....T....R.
01C0: 80 F0 FF FF 7F F0 FF FF  7F 39 30 30 32 01 4B 03  .........9002.K.
01D0: 02 00 00 18 80 80 2C 02  5C 00 19 80 5C 01 19 80  ......,.\...\...
01E0: 9A 48 1A 80 23 7B 1A F0  0E 01 1C 1B 80 45 15 80  .H..#{.......E..
01F0: F0 FF FF 7F F0 FF FF 7F  39 30 30 33 0D 80 1A 33  ........9003...3
0200: 09 29 10 1A F0 0E 01 A2  1C 0A 80 27 10 1A F0 0E  .).........'....
0210: 01 A4 2B 1A F0 0E 01 1C  80 23 52 15 80 F0 FF FF  ..+......#R.....
0220: 7F F0 FF FF 7F 39 30 30  33 01 4B 03 02 00 00 0F  .....9003.K.....
0230: 80 80 5F 02 45 15 80 F0  FF FF 7F F0 FF FF 7F 39  .._.E..........9
0240: 30 30 34 0D 80 2B 1A F0  0E 01 1D 80 23 52 15 80  004..+......#R..
0250: F0 FF FF 7F F0 FF FF 7F  39 30 30 34 01 4B 03 02  ........9004.K..
0260: 00 00 1E 80 80 99 02 45  15 80 F0 FF FF 7F F0 FF  .......E........
0270: FF 7F 39 30 30 35 0D 80  2B 1A F0 0E 01 1F 80 23  ..9005..+......#
0280: 29 10 1A F0 0E 01 A3 52  15 80 F0 FF FF 7F F0 FF  )......R........
0290: FF 7F 39 30 30 35 01 4B  03 02 00 00 10 80 80 F4  ..9005.K........
02A0: 02 45 15 80 F0 FF FF 7F  F0 FF FF 7F 39 30 30 36  .E..........9006
02B0: 0D 80 1C 0A 80 79 00 1A  F0 0E 01 F0 FF FF 7F 27  .....y.........'
02C0: 10 1A F0 0E 01 AD 2B 1A  F0 0E 01 20 80 23 03 02  ......+.... .#..
02D0: 10 21 80 2B 1A F0 0E 01  22 80 23 27 10 1A F0 0E  .!.+....".#'....
02E0: 01 AE 52 15 80 F0 FF FF  7F F0 FF FF 7F 39 30 30  ..R..........900
02F0: 36 01 4B 03 02 00 00 11  80 80 FF 02 01 4B 03 02  6.K..........K..
0300: 00 00 0C 80 80 4B 03 45  15 80 F0 FF FF 7F F0 FF  .....K.E........
0310: FF 7F 39 30 30 38 0D 80  7B 1A F0 0E 01 27 10 1A  ..9008..{....'..
0320: F0 0E 01 AC 1C 16 80 79  00 1A F0 0E 01 F0 FF FF  .......y........
0330: 7F 2B 1A F0 0E 01 23 80  23 52 15 80 F0 FF FF 7F  .+....#.#R......
0340: F0 FF FF 7F 39 30 30 38  01 4B 03 1B              ....9008.K..    
```

## Opcodes

```
  0: 0x0001 [0x42] SET_CLI_EVENT_CANCEL_DATA()
  1: 0x0002 [0x1A] CALL_SUBROUTINE(address=0x0954)
  2: 0x0005 [0x46] CAMERA_CONTROL: Disable user control
  3: 0x0007 [0x38] SET_CLIENT_EVENT_MODE(mode=19*)
  4: 0x000A [0x75] LOAD_ROOM(Load indoor room, room=405*)
  5: 0x000E [0x75] LOAD_ROOM(No action)
  6: 0x0010 [0x27] REQ_SET(priority=0x10, entity_id=LocalPlayer, tag_num=0x79)
  7: 0x0017 [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA1)
  8: 0x001E [0xBA] SET_ENTITY_POSITION(entity_id=LocalPlayer, pos_x=122.148*, pos_z=111.459*, pos_y=-3.000*, direction=6.7°*)
  9: 0x002B [0xBA] SET_ENTITY_POSITION(entity_id=Shantotto (ID: 17756186/0x010EF01A), pos_x=122.489*, pos_z=113.640*, pos_y=-3.000*, direction=17.6°*)
 10: 0x0038 [0x80] LOAD_WAIT(entity=LocalPlayer)
 11: 0x003D [0x80] LOAD_WAIT(entity=Shantotto (ID: 17756186/0x010EF01A))
 12: 0x0042 [0x1C] WAIT(15* ticks)
 13: 0x0045 [0x4A] LocalPlayer looks at Shantotto (ID: 17756186/0x010EF01A)
 14: 0x004E [0x6F] WAIT_FRAME_DELAY: Yield until WaitTime reaches zero
 15: 0x004F [0x76] CHECK_ENTITY_RENDER_FLAGS: Wait until LocalPlayer Render.Flags0 and Render.Flags3 conditions are met
 16: 0x0054 [0x1C] WAIT(30* ticks)
 17: 0x0057 [0x03] ExtData[1]->WorkLocal[0] = 1*
 18: 0x005C [0x02] IF !(ExtData[1]->WorkLocal[0] > 8*) GOTO 0x00EC
 19: 0x0064 [0x02] IF !(0* < ExtData[1]->WorkLocal[0]) GOTO 0x00E4
 20: 0x006C [0x02] IF !(ExtData[1]->WorkLocal[0] == 2*) GOTO 0x0083
 21: 0x0074 [0x1A] CALL_SUBROUTINE(address=0x0933)
 22: 0x0077 [0x4A] Shantotto (ID: 17756186/0x010EF01A) looks at LocalPlayer
 23: 0x0080 [0x01] GOTO 0x00E4
 24: 0x0083 [0x02] IF !(ExtData[1]->WorkLocal[0] == 4*) GOTO 0x009C
 25: 0x008B [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA2)
 26: 0x0092 [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA4)
 27: 0x0099 [0x01] GOTO 0x00E4
 28: 0x009C [0x02] IF !(ExtData[1]->WorkLocal[0] == 6*) GOTO 0x00AE
 29: 0x00A4 [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA3)
 30: 0x00AB [0x01] GOTO 0x00E4
 31: 0x00AE [0x02] IF !(ExtData[1]->WorkLocal[0] == 7*) GOTO 0x00C0
 32: 0x00B6 [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xAD)
 33: 0x00BD [0x01] GOTO 0x00E4
 34: 0x00C0 [0x02] IF !(ExtData[1]->WorkLocal[0] == 8*) GOTO 0x00D2
 35: 0x00C8 [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xAE)
 36: 0x00CF [0x01] GOTO 0x00E4
 37: 0x00D2 [0x02] IF !(ExtData[1]->WorkLocal[0] == 9*) GOTO 0x00E4
 38: 0x00DA [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xAC)
 39: 0x00E1 [0x01] GOTO 0x00E4

SUBROUTINE_00E4:
 40: 0x00E4 [0x07] ExtData[1]->WorkLocal[0] += 1*
 41: 0x00E9 [0x01] GOTO 0x005C
 42: 0x00EC [0x03] ExtData[1]->WorkLocal[0] = 1*

SUBROUTINE_00F1:
 43: 0x00F1 [0x02] IF !(ExtData[1]->WorkLocal[0] > 8*) GOTO 0x010C
 44: 0x00F9 [0x02] IF !(0* > ExtData[1]->WorkLocal[0]) GOTO 0x0104
 45: 0x0101 [0x1A] CALL_SUBROUTINE(address=0x013D)
 46: 0x0104 [0x07] ExtData[1]->WorkLocal[0] += 1*
 47: 0x0109 [0x01] GOTO 0x00F1
 48: 0x010C [0x1A] CALL_SUBROUTINE(address=0x0954)
 49: 0x010F [0x1C] WAIT(30* ticks)
 50: 0x0112 [0x5C] MUSIC_CONTROL: Set Idle (Day) music to song 151*
 51: 0x0116 [0x5C] MUSIC_CONTROL: Set Idle (Night) music to song 151*
 52: 0x011A [0x9A] WAIT_MUSIC_SERVER()
 53: 0x011B [0x46] CAMERA_CONTROL: Restore default settings
 54: 0x011D [0x45] LOAD_SCHEDULED_TASK: Load scheduler "fdi2" with entities [LocalPlayer, LocalPlayer], work=[200*, 0*]
 55: 0x012E [0x21] END_EVENT
 56: 0x012F [0x00] END_REQSTACK()

SUBROUTINE_013D:
 57: 0x013D [0x02] IF !(ExtData[1]->WorkLocal[0] == 1*) GOTO 0x0192
 58: 0x0145 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9001" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
 59: 0x0156 [0x1A] CALL_SUBROUTINE(address=0x0933)
 60: 0x0159 [0x1C] WAIT(30* ticks)
 61: 0x015C [0x4A] Shantotto (ID: 17756186/0x010EF01A) looks at LocalPlayer
 62: 0x0165 [0x6F] WAIT_FRAME_DELAY: Yield until WaitTime reaches zero
 63: 0x0166 [0x76] CHECK_ENTITY_RENDER_FLAGS: Wait until Shantotto (ID: 17756186/0x010EF01A) Render.Flags0 and Render.Flags3 conditions are met
 64: 0x016B [0x1C] WAIT(30* ticks)
 65: 0x016E [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9697*]:
    → "Oho! Welcome, my adventuring friend!\u007F1\u0000\u0007"
 66: 0x0175 [0x23] WAIT_FOR_DIALOG_INTERACTION
 67: 0x0176 [0x29] REQ_SET_WAIT(priority=0x10, entity_id=LocalPlayer, tag_num=0x7C)
 68: 0x017D [0x1C] WAIT(60* ticks)
 69: 0x0180 [0x52] END_LOAD_SCHEDULER: End scheduler "9001" with entities [LocalPlayer, LocalPlayer], work=464*
 70: 0x018F [0x01] GOTO 0x034B
 71: 0x0192 [0x02] IF !(ExtData[1]->WorkLocal[0] == 2*) GOTO 0x01D0
 72: 0x019A [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9002" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
 73: 0x01AB [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9698*]:
    → "Let me guess--you've a curse you'd like me to mend.\u007F1\u0000\u0007"
 74: 0x01B2 [0x23] WAIT_FOR_DIALOG_INTERACTION
 75: 0x01B3 [0x5D] SET_MUSIC_VOLUME(volume=0*, fade_time=60*)
 76: 0x01B8 [0x1A] CALL_SUBROUTINE(address=0x0954)
 77: 0x01BB [0x1C] WAIT(30* ticks)
 78: 0x01BE [0x52] END_LOAD_SCHEDULER: End scheduler "9002" with entities [LocalPlayer, LocalPlayer], work=464*
 79: 0x01CD [0x01] GOTO 0x034B
 80: 0x01D0 [0x02] IF !(ExtData[1]->WorkLocal[0] == 3*) GOTO 0x022C
 81: 0x01D8 [0x5C] MUSIC_CONTROL: Set Idle (Day) music to song 164*
 82: 0x01DC [0x5C] MUSIC_CONTROL: Set Idle (Night) music to song 164*
 83: 0x01E0 [0x9A] WAIT_MUSIC_SERVER()
 84: 0x01E1 [0x48] [System] [9705*]:
    → "     \u007F4\u0001\u0000\u0007"
 85: 0x01E4 [0x23] WAIT_FOR_DIALOG_INTERACTION
 86: 0x01E5 [0x7B] Shantotto (ID: 17756186/0x010EF01A) stops talking
 87: 0x01EA [0x1C] WAIT(80* ticks)
 88: 0x01ED [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9003" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
 89: 0x01FE [0x1A] CALL_SUBROUTINE(address=0x0933)
 90: 0x0201 [0x29] REQ_SET_WAIT(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA2)
 91: 0x0208 [0x1C] WAIT(30* ticks)
 92: 0x020B [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA4)
 93: 0x0212 [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9699*]:
    → "I see, I see...\u007F1\u0000\u0007"
 94: 0x0219 [0x23] WAIT_FOR_DIALOG_INTERACTION
 95: 0x021A [0x52] END_LOAD_SCHEDULER: End scheduler "9003" with entities [LocalPlayer, LocalPlayer], work=464*
 96: 0x0229 [0x01] GOTO 0x034B
 97: 0x022C [0x02] IF !(ExtData[1]->WorkLocal[0] == 4*) GOTO 0x025F
 98: 0x0234 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9004" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
 99: 0x0245 [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9700*]:
    → "Clattering shutters and rattling doors?\u0007A most sinister incantation, this hex of yours...\u007F1\u0000\u0007"
100: 0x024C [0x23] WAIT_FOR_DIALOG_INTERACTION
101: 0x024D [0x52] END_LOAD_SCHEDULER: End scheduler "9004" with entities [LocalPlayer, LocalPlayer], work=464*
102: 0x025C [0x01] GOTO 0x034B
103: 0x025F [0x02] IF !(ExtData[1]->WorkLocal[0] == 5*) GOTO 0x0299
104: 0x0267 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9005" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
105: 0x0278 [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9701*]:
    → "But fear not for your humble dwelling.\u0007The peerless Shantotto will administer a proper dispelling!\u0007O\u0001`hohoho!\u007F1\u0000\u0007"
106: 0x027F [0x23] WAIT_FOR_DIALOG_INTERACTION
107: 0x0280 [0x29] REQ_SET_WAIT(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xA3)
108: 0x0287 [0x52] END_LOAD_SCHEDULER: End scheduler "9005" with entities [LocalPlayer, LocalPlayer], work=464*
109: 0x0296 [0x01] GOTO 0x034B
110: 0x0299 [0x02] IF !(ExtData[1]->WorkLocal[0] == 6*) GOTO 0x02F4
111: 0x02A1 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9006" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
112: 0x02B2 [0x1C] WAIT(30* ticks)
113: 0x02B5 [0x79] Shantotto (ID: 17756186/0x010EF01A) looks at LocalPlayer (Basic look)
114: 0x02BF [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xAD)
115: 0x02C6 [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9702*]:
    → "Sadly, I fear there's just one snag.\u0007You see, a vital ingredient has gone missing from my reagent bag...\u007F1\u0000\u0007"
116: 0x02CD [0x23] WAIT_FOR_DIALOG_INTERACTION
117: 0x02CE [0x03] Work_Zone[2] = 1143*
118: 0x02D3 [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9703*]:
    → "Yes, \u0001\u00056\u0002\u0000\u0000\u0000 will be needed, methinks,\u0007in order to root out this baleful jinx.\u007F1\u0000\u0007"
119: 0x02DA [0x23] WAIT_FOR_DIALOG_INTERACTION
120: 0x02DB [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xAE)
121: 0x02E2 [0x52] END_LOAD_SCHEDULER: End scheduler "9006" with entities [LocalPlayer, LocalPlayer], work=464*
122: 0x02F1 [0x01] GOTO 0x034B
123: 0x02F4 [0x02] IF !(ExtData[1]->WorkLocal[0] == 7*) GOTO 0x02FF
124: 0x02FC [0x01] GOTO 0x034B
125: 0x02FF [0x02] IF !(ExtData[1]->WorkLocal[0] == 8*) GOTO 0x034B
126: 0x0307 [0x45] LOAD_SCHEDULED_TASK: Load scheduler "9008" with entities [LocalPlayer, LocalPlayer], work=[464*, 0*]
127: 0x0318 [0x7B] Shantotto (ID: 17756186/0x010EF01A) stops talking
128: 0x031D [0x27] REQ_SET(priority=0x10, entity_id=Shantotto (ID: 17756186/0x010EF01A), tag_num=0xAC)
129: 0x0324 [0x1C] WAIT(60* ticks)
130: 0x0327 [0x79] Shantotto (ID: 17756186/0x010EF01A) looks at LocalPlayer (Basic look)
131: 0x0331 [0x2B] Shantotto (ID: 17756186/0x010EF01A) [9704*]:
    → "Bring me what I seek,\u0007and we shall address the matter you bespeak.\u007F1\u0000\u0007"
132: 0x0338 [0x23] WAIT_FOR_DIALOG_INTERACTION
133: 0x0339 [0x52] END_LOAD_SCHEDULER: End scheduler "9008" with entities [LocalPlayer, LocalPlayer], work=464*
134: 0x0348 [0x01] GOTO 0x034B

SUBROUTINE_034B:
135: 0x034B [0x1B] RETURN
```

## Data or dead code:

```
# Dead code (unreachable instructions):
     0x0130 [0x02] IF !(0* == 1*) GOTO 0x013C
     0x0138 [0x48] [System] [9697*]:
    → "Oho! Welcome, my adventuring friend!\u007F1\u0000\u0007"
     0x013B [0x23] WAIT_FOR_DIALOG_INTERACTION
     0x013C [0x1B] RETURN
```